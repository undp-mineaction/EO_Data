<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chrono Map with Daily TimeSlider</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://js.arcgis.com/4.28/esri/themes/dark/main.css" rel="stylesheet" />
  <script src="https://js.arcgis.com/4.28/"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap" rel="stylesheet">

  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
      font-family: 'Nunito', 'Avenir', sans-serif;
    }

    #infoBox {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.3);
      padding: 12px 18px;
      z-index: 10;
      color: white;
      min-width: 260px;
      display: flex;
      flex-direction: column;
    }

    #timeSliderDiv {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60px;
      z-index: 10;
    }

    #metadataContainer {
      position: absolute;
      bottom: 60px;
      left: 0;
      right: 0;
      height: 100px;
      overflow-x: auto;
      display: flex;
      background: rgba(0, 0, 0, 0.4);
      z-index: 9;
      border-top: 1px solid #888;
    }

    .metadataDay {
      min-width: 120px;
      padding: 6px;
      color: white;
      border-right: 1px solid #555;
      font-size: 12px;
      text-align: center;
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div id="viewDiv"></div>

  <div id="infoBox">
    <h3>EO Casualties</h3>
    <div id="counts">Boys: 0 | Girls: 0 | Men: 0 | Women: 0</div>
  </div>

  <div id="metadataContainer"></div>
  <div id="timeSliderDiv"></div>

  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/widgets/TimeSlider",
      "esri/TimeExtent"
    ], function(Map, MapView, FeatureLayer, TimeSlider, TimeExtent) {

      const map = new Map({
        basemap: "dark-gray-vector"
      });

      const view = new MapView({
        container: "viewDiv",
        map: map,
        center: [31.1656, 48.3794], // Ukraine
        zoom: 6,
        ui: {
          components: ["attribution"] // removes zoom buttons
        }
      });

      const casualtiesLayer = new FeatureLayer({
        url: "https://your-server.com/arcgis/rest/services/YourLayer/MapServer/0", // Replace with your layer
        outFields: ["*"],
        title: "Casualties",
        timeInfo: {
          startField: "report_date"
        }
      });

      map.add(casualtiesLayer);

      view.when(() => {
        const timeSlider = new TimeSlider({
          container: "timeSliderDiv",
          view: view,
          fullTimeExtent: new TimeExtent({
            start: new Date("2022-01-01"),
            end: new Date("2025-12-31")
          }),
          mode: "time-window",
          values: [new Date("2022-01-01"), new Date("2022-01-15")],
          playRate: 1000,
          stops: {
            interval: {
              value: 1,
              unit: "days"
            }
          }
        });

        casualtiesLayer.when(() => {
          view.watch("timeExtent", () => {
            const query = casualtiesLayer.createQuery();
            query.timeExtent = view.timeExtent;
            query.returnGeometry = false;

            casualtiesLayer.queryFeatures(query).then((result) => {
              const features = result.features;

              // Update top-left info box
              let boys = 0, girls = 0, men = 0, women = 0;
              const dayGroups = {};

              features.forEach(f => {
                const attr = f.attributes;
                const day = new Date(attr.report_date).toISOString().split("T")[0];

                // Replace with actual field names as needed
                boys += attr.boys || 0;
                girls += attr.girls || 0;
                men += attr.men || 0;
                women += attr.women || 0;

                if (!dayGroups[day]) dayGroups[day] = [];
                dayGroups[day].push(attr);
              });

              document.getElementById("counts").textContent =
                `Boys: ${boys} | Girls: ${girls} | Men: ${men} | Women: ${women}`;

              // Populate metadata strips
              const container = document.getElementById("metadataContainer");
              container.innerHTML = "";

              Object.entries(dayGroups).forEach(([day, attrs]) => {
                let deaths = 0;
                let injured = 0;

                attrs.forEach(a => {
                  deaths += a.deaths || 0;
                  injured += a.injured || 0;
                });

                const box = document.createElement("div");
                box.className = "metadataDay";
                box.innerHTML = `<strong>${day}</strong><br/>
                                 Events: ${attrs.length}<br/>
                                 Deaths: ${deaths}<br/>
                                 Injured: ${injured}`;
                container.appendChild(box);
              });

            });
          });
        });
      });
    });
  </script>
</body>
</html>
✅ Next Steps:
Replace the layer URL with your actual ArcGIS FeatureLayer that includes a report_date field.

Replace boys, girls, deaths, and injured with your real attribute names if they differ.

Would you like me to also include tooltips, icons, or refine the styling for mobile?







You said:
add replace map layer with this https://geosmarthosting.undp.org/arcgis/rest/services/Hosted/Copy_of_accidents_pull/FeatureServer


ChatGPT said:
Great! Here's your updated full code with the ArcGIS Feature Layer:

✅ Replaced Feature Layer URL
New layer:
https://geosmarthosting.undp.org/arcgis/rest/services/Hosted/Copy_of_accidents_pull/FeatureServer/0

✅ Updated Chrono Map Code:
html
Copy
Edit
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chrono Map with Daily TimeSlider</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://js.arcgis.com/4.28/esri/themes/dark/main.css" rel="stylesheet" />
  <script src="https://js.arcgis.com/4.28/"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap" rel="stylesheet">

  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
      font-family: 'Nunito', 'Avenir', sans-serif;
    }

    #infoBox {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.3);
      padding: 12px 18px;
      z-index: 10;
      color: white;
      min-width: 260px;
      display: flex;
      flex-direction: column;
    }

    #timeSliderDiv {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60px;
      z-index: 10;
    }

    #metadataContainer {
      position: absolute;
      bottom: 60px;
      left: 0;
      right: 0;
      height: 100px;
      overflow-x: auto;
      display: flex;
      background: rgba(0, 0, 0, 0.4);
      z-index: 9;
      border-top: 1px solid #888;
    }

    .metadataDay {
      min-width: 120px;
      padding: 6px;
      color: white;
      border-right: 1px solid #555;
      font-size: 12px;
      text-align: center;
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div id="viewDiv"></div>

  <div id="infoBox">
    <h3>EO Casualties</h3>
    <div id="counts">Boys: 0 | Girls: 0 | Men: 0 | Women: 0</div>
  </div>

  <div id="metadataContainer"></div>
  <div id="timeSliderDiv"></div>

  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/widgets/TimeSlider",
      "esri/TimeExtent"
    ], function(Map, MapView, FeatureLayer, TimeSlider, TimeExtent) {

      const map = new Map({
        basemap: "dark-gray-vector"
      });

      const view = new MapView({
        container: "viewDiv",
        map: map,
        center: [31.1656, 48.3794], // Ukraine
        zoom: 6,
        ui: {
          components: ["attribution"] // removes zoom buttons
        }
      });

      const casualtiesLayer = new FeatureLayer({
        url: "https://geosmarthosting.undp.org/arcgis/rest/services/Hosted/Copy_of_accidents_pull/FeatureServer/0",
        outFields: ["*"],
        title: "Casualties",
        timeInfo: {
          startField: "report_date"
        }
      });

      map.add(casualtiesLayer);

      view.when(() => {
        const timeSlider = new TimeSlider({
          container: "timeSliderDiv",
          view: view,
          fullTimeExtent: new TimeExtent({
            start: new Date("2022-01-01"),
            end: new Date("2025-12-31")
          }),
          mode: "time-window",
          values: [new Date("2022-01-01"), new Date("2022-01-15")],
          playRate: 1000,
          stops: {
            interval: {
              value: 1,
              unit: "days"
            }
          }
        });

        casualtiesLayer.when(() => {
          view.watch("timeExtent", () => {
            const query = casualtiesLayer.createQuery();
            query.timeExtent = view.timeExtent;
            query.returnGeometry = false;

            casualtiesLayer.queryFeatures(query).then((result) => {
              const features = result.features;

              // Update top-left info box
              let boys = 0, girls = 0, men = 0, women = 0;
              const dayGroups = {};

              features.forEach(f => {
                const attr = f.attributes;
                const day = new Date(attr.report_date).toISOString().split("T")[0];

                boys += attr.boys || 0;
                girls += attr.girls || 0;
                men += attr.men || 0;
                women += attr.women || 0;

                if (!dayGroups[day]) dayGroups[day] = [];
                dayGroups[day].push(attr);
              });

              document.getElementById("counts").textContent =
                `Boys: ${boys} | Girls: ${girls} | Men: ${men} | Women: ${women}`;

              // Populate metadata strips
              const container = document.getElementById("metadataContainer");
              container.innerHTML = "";

              Object.entries(dayGroups).forEach(([day, attrs]) => {
                let deaths = 0;
                let injured = 0;

                attrs.forEach(a => {
                  deaths += a.deaths || 0;
                  injured += a.injured || 0;
                });

                const box = document.createElement("div");
                box.className = "metadataDay";
                box.innerHTML = `<strong>${day}</strong><br/>
                                 Events: ${attrs.length}<br/>
                                 Deaths: ${deaths}<br/>
                                 Injured: ${injured}`;
                container.appendChild(box);
              });

            });
          });
        });
      });
    });
  </script>
</body>
</html>
